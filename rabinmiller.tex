При формировании ключей в алгоритме RSA необходимо выбрать два больших простых числа. Это можно сделать следующим образом. Выбирается случайно большое число и проверяется, является ли оно составным или простым. Если оно простое, то мы его берём, если же оно оказывается составным, мы его отбрасываем и проверяем на простоту новое случайное число. Процесс повторяем до тех пор, пока не найдем простое число. Этот процесс достаточно быстро закончится по двум причинам. Во-первых, простых чисел достаточно много. Среди натуральных чисел в диапазоне от 1 до $n$ существует приблизительно $\frac{n}{\ln n}$ простых чисел, то есть высока вероятность того, что произвольно выбранное число окажется простым. Во-вторых, существуют хорошие алгоритмы, проверяющие является ли число простым. В 2003 году благодаря трудам трёх индийских математиков Агравала, Кайала и Саксены стал известен детерминированный полиномиальный алгоритм проверки числа на простоту.  Но этот алгоритм на практике является, не смотря на его полиномиальность, требовательным к временным ресурсам, поэтому, как до 2003 года, так и до сих пор, используются вероятностные полиномиальные алгоритмы проверки числа на простоту. Один из них называется тестом Рабина-Миллера и мы его изучим.

В 1976 г. Миллером был предложен следующий алгоритм проверки простоты числа. Если $n$~-- простое число, $n-1=2^s\cdot t$, где $t$ нечетное, то согласно малой теореме Ферма, о которой говорится в курсе лекций, для каждого $a$ с условием $(a,n)=1$ хотя бы одна из скобок в произведении $\left(a^t-1\right)\left(a^t+1\right)\left(a^{2t}+1\right)\cdot \ldots \cdot \left(a^{2^{s-1}t}+1\right)=a^{n-1}-1$ делится на $n$. Обращение этого свойства можно использовать, чтобы отличать составные числа от простых. 

Пусть $n$~-- нечетное составное число, $n-1=2^s\cdot t$, где $t$ нечетно. Назовем целое число $a$, $1<a<n$, свидетелем простоты числа $n$, если выполняются следующие условия: 



\begin{description}
\item[a)]\label{a}  $n$ не делится на $a$;

\item[b)]\label{b}  $a^t=1\pmod n$ или существует целое $k$, $0\le k<s$, такое, что $a^{2^kt}=-1\pmod n$.
\end{description}

Из сказанного ранее следует, что для простого числа $n$ все такие $a$ являются свидетелем его простоты. Если же $n$ составное число, то, как доказал Рабин, свидетелей простоты менее чем $\frac{1}{4}\left(n-1\right)$. 
На этом основании строится вероятностный алгоритм, отличающий составные числа от простых.

Алгоритм Миллера-Рабина, доказывающий непростоту числа:

\begin{enumerate}
\item  Выберем случайным образом число $a$, $1<a<n$, и проверим для этого числа указанные выше свойства~a) и b). 

\item  Если хотя бы одно из них нарушается, то число $n$ составное. 

\item  Если выполнены оба условия a) и b), возвращаемся к шагу 1. 
\end{enumerate}

Из сказанного выше следует, что составное число не будет определено как составное после однократного выполнения шагов 1-3 с вероятностью не большей $\frac{1}{4}$. А вероятность не определить его как составное после $k$ повторений не превосходит $\frac{1}{4^k}$, т.е. убывает очень быстро.

Особенностью вероятностного алгоритма Рабина-Миллера является возможность ошибки~-- принять неправильный результат его работы за правильный. Такие алгоритмы называются вероятностными алгоритмами  типа Монте-Карло\index{Алгоритм!Монте-Карло} (для подробностей смотрите класс алгоритмов \textbf{BPP}). Позже мы познакомимся еще с одним вероятностным алгоритмом (поиск квадратичных вычетов), с другой особенностью: результат его работы всегда правильный ответ, но время его работы с ненулевой, но пренебрежимо маленькой вероятностью может оказаться непредсказуемо долгим. Такие вероятностные алгоритмы называются алгоритмами типа\index{Алгоритм!Лас-Вегас} Лас-Вегас (смотрите в литературе для подробностей класс \textbf{ZPP}). Как в случае алгоритмов Монте-Карло, так и в случае алгоритмов Лас-Вегаса, можно добиться практически ничтожной вероятности их нежелательного поведения, то есть первый с вероятностью практически равной 1 будет давать правильный ответ, а другой с вероятностью практически равной 1 работать полиномиальное время, то есть быстро.

\subsection*{Упражнения}


\begin{enumerate}
	\item Вычислите вероятность того, что произвольно выбранное число состоящее из 100 цифр будет простым?
	\item Проверьте на простоту число $65$ с помощью теста Рабина-Миллера при $a=8$, $a=18$, $a=47$, $a=57$. Сделайте вывод.
\end{enumerate}
